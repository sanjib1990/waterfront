machine:
  build:
    version: ubuntu-14.04-XXL-upstart-1189-5614f37

  environment:
      CIRCLE_ENV: test

  pre:
    - sudo add-apt-repository ppa:ondrej/php -y
    - sudo apt-get update;
    - sudo apt-get install php7.2 php-all-dev php7.2-cli php7.2-common php7.2-curl php7.2-gd php7.2-mysql php7.2-sqlite3 php7.2-xml php7.2-zip php7.2-mbstring php7.2-fpm php7.2-bz2 php7.2-dev
    - sudo update-alternatives --set php /usr/bin/php7.2
    - php -v

  node:
    version: v6.1.0

dependencies:
  pre:
    - cp .env.testing .env

test:
  override:
    - vendor/bin/phpunit tests
    - npm run test
